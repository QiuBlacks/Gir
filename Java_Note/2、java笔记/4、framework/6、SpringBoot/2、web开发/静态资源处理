[TOC]



# 静态资源处理

## 一、处理方法

### 1、在指定目录下（推荐）

以下四个目录存放的静态资源可以被我们识别：

```xml
classpath:/META-INF/resources/
classpath:/resources/
classpath:/static/
classpath:/public/
```

优先级：resources>static>public

访问路径：

### 2、webjars 

Webjars本质就是以==jar包==的方式引入我们的静态资源 ， 我们以前要导入一个静态资源文件，直接导入即可。

网站：https://www.webjars.org 

要使用jQuery，我们只要在网站搜索，引入jQuery对应版本的pom依赖即可！

访问路径：

```
http://localhost:8080/webjars/jquery/3.4.1/jquery.js
```



### 3、自定义静态资源路径

通过在配置文件中配置路径

```
spring.resources.static-locations=classpath:/coding/,classpath:/kuang/
```



## 二、源码分析

在WebMvcAutoConfigurationAdapter配置类 的addResourceHandlers 方法

```Java
@Override
public void addResourceHandlers(ResourceHandlerRegistry registry) {
    
    if (!this.resourceProperties.isAddMappings()) {
        // 已禁用默认资源处理
        logger.debug("Default resource handling disabled");
        return;
    }
    // 缓存控制
    Duration cachePeriod = this.resourceProperties.getCache().getPeriod();
    CacheControl cacheControl = this.resourceProperties.getCache().getCachecontrol().toHttpCacheControl();
    // 第一种：webjars 配置
    if (!registry.hasMappingForPattern("/webjars/**")) {
        customizeResourceHandlerRegistration(registry.addResourceHandler("/webjars/**")
                                             .addResourceLocations("classpath:/META-INF/resources/webjars/")
                                             .setCachePeriod(getSeconds(cachePeriod)).setCacheControl(cacheControl));
    }
    // 第二种：静态资源配置：其中 staticPathPattern = "/**";
    String staticPathPattern = this.mvcProperties.getStaticPathPattern();
    if (!registry.hasMappingForPattern(staticPathPattern)) {
        customizeResourceHandlerRegistration(registry.addResourceHandler(staticPathPattern)
                                             .addResourceLocations(getResourceLocations(this.resourceProperties.getStaticLocations()))
                                             .setCachePeriod(getSeconds(cachePeriod)).setCacheControl(cacheControl));
    }
```

第二种静态资源配置的resourceProperties为：

```Java
public class ResourceProperties {

	private static final String[] CLASSPATH_RESOURCE_LOCATIONS = { "classpath:/META-INF/resources/",
			"classpath:/resources/", "classpath:/static/", "classpath:/public/" };
}
```







# 首页处理