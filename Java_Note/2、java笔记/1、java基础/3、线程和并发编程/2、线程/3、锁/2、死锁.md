[TOC]



# **死锁**

## **一、基本介绍**

### 1、定义

多个线程同时被阻塞，它们中的一个或者全部都在等待某个资源被释放。由于线程被无限期地阻塞，因此程序不可能正常终止。

### 2、图解

如下图所示，线程 A 持有资源 2，线程 B 持有资源 1，他们同时都想申请对方的资源，所以这两个线程就会互相等待而进入死锁状态

<img src="E:\black user\Java\有道云截图\image-20200519155033827.png" alt="image-20200519155033827" style="zoom: 67%;" />





## 二、产生死锁的原因

### 1、竞争资源

1）系统中的资源可以分为两类：

- 可剥夺资源，是指某进程在获得这类资源后，该资源可以再被其他进程或系统剥夺，CPU和主存均属于可剥夺性资源；
- 另一类资源是不可剥夺资源，当系统把这类资源分配给某进程后，再不能强行收回，只能在进程用完后自行释放，如磁带机、打印机等。

产生死锁中的竞争资源之一指的是竞争不可剥夺资源（例如：系统中只有一台打印机，可供进程P1使用，假定P1已占用了打印机，若P2继续要求打印机打印将阻塞）

产生死锁中的竞争资源另外一种资源指的是竞争临时资源（临时资源包括硬件中断、信号、消息、缓冲区内的消息等），通常消息通信顺序进行不当，则会产生死锁


### 2、进程间推进顺序非法

- 若P1保持了资源R1,P2保持了资源R2，系统处于不安全状态，因为这两个进程再向前推进，便可能发生死锁
- 例如，当P1运行到P1：Request（R2）时，将因R2已被P2占用而阻塞；当P2运行到P2：Request（R1）时，也将因R1已被P1占用而阻塞，于是发生进程死锁



## **三、死锁的四个必要条件**

- 互斥条件：				一个资源每次只能被一个进程使用。
- 请求与保持条件：   一个进程因请求资源而阻塞时，对已获得的资源保持不放。
- 不剥夺条件:	          进程已获得的资源，在末使用完之前，不能强行剥夺。
- 循环等待条件:      	若干进程之间形成一种头尾相接的循环等待资源关系。





## **三、解决死锁（破坏四个必要条件）**

### 1、预防死锁

- 资源一次性分配：一次性分配所有资源，这样就不会再有请求了：（破坏请求条件）
- 只要有一个资源得不到分配，也不给这个进程分配其他的资源：（破坏请保持条件）
- 可剥夺资源：即当某进程获得了部分资源，但得不到其它资源，则释放已占有的资源（破坏不可剥夺条件）
- 资源有序分配法：系统给每类资源赋予一个编号，每一个进程按编号递增的顺序请求资源，释放则相反（破坏环路等待条件）
  

### 2、避免死锁

### 3、检测死锁

### 4、解除死锁



