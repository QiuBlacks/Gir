[TOC]



# IO多路复用

---
参考：[ IO多路复用详解](https://www.pdai.tech/md/java/io/java-io-nio-select-epoll.html)

# 一、基本介绍

## 1、基本概念
&emsp;&emsp;I/O就是指的我们网络I/O,多路指多个TCP连接(或多个Channel)，复用指复用一个或少量线程。串起来理解就是==很多个网络I/O复用一个或少量的线程来处理这些连接==。

<img src="https://www.pdai.tech/_images/io/java-io-nio-1.png" alt="image" style="zoom: 80%;" />

## 2、四种实现方式
&emsp;&emsp;select、poll、epoll、kqueue

![image-20200608222159487](E:\black user\Java\有道云截图\image-20200608222159487.png)
## 3、使用场景
&emsp;&emsp;多路复用IO技术最适用的是“高并发”场景，所谓==高并发是指1毫秒内至少同时有上千个连接请求准备好==。其他情况下多路复用IO技术发挥不出来它的优势。
## 4、特征
&emsp;&emsp;多路复用IO技术是需要==操作系统==进行支持的，是操作系统的内核实现。<br>
&emsp;&emsp;其特点就是操作系统可以同时扫描同一个端口上不同网络连接的时间。


# 二、重要概念
## 1、Channel
&emsp;&emsp;通道，被建立的一个应用程序和操作系统交互事件、传递内容的渠道(注意是连接到操作系统)。<br>
&emsp;&emsp;一个通道会有一个专属的文件状态描述符。
## 2、Buffer（数据缓存区）
### 1）基本介绍
&emsp;&emsp; 在JAVA NIO 框架中，为了保证每个通道的数据读写速度JAVA NIO 框架为每一种需要支持数据读写的通道集成了Buffer的支持。
### 2）两种工作模式
&emsp;&emsp;写模式和读模式。<br>
&emsp;&emsp;在读模式下，应用程序只能从Buffer中读取数据，不能进行写操作。<br>
&emsp;&emsp;但是在写模式下，应用程序是可以进行读操作的，这就表示可能会出现脏读的情况。所以一旦您决定要从Buffer中读取数据，一定要将Buffer的状态改为读模式。<br>

![image](https://www.pdai.tech/_images/io/java-io-nio-3.png)<br>

- position: 缓存区目前在操作的数据块位置 
- limit: 缓存区最大可以进行操作的位置。缓存区的读写状态正式由这个属性控制的
- capacity: 缓存区的最大容量。这个容量是在缓存区创建时进行指定的。由于高并发时通道数量往往会很庞大，所以每一个缓存区的容量最好不要过大。


## 3、Selector（选择器）









## 三、多路复用IO的优缺点

1、不用再使用多线程来进行IO处理了(包括操作系统内核IO管理模块和应用程序进程而言)。当然实际业务的处理中，应用程序进程还是可以引入线程池技术的

2、同一个端口可以处理多种协议，例如，使用ServerSocketChannel测测的服务器端口监听，既可以处理TCP协议又可以处理UDP协议。

3、操作系统级别的优化: 多路复用IO技术可以是操作系统级别在一个端口上能够同时接受多个客户端的IO事件。同时具有之前我们讲到的阻塞式同步IO和非阻塞式同步IO的所有特点。Selector的一部分作用更相当于“轮询代理器”。

4、都是同步IO: 目前我们介绍的 阻塞式IO、非阻塞式IO甚至包括多路复用IO，这些都是基于操作系统级别对“同步IO”的实现。我们一直在说“同步IO”，一直都没有详细说，什么叫做“同步IO”。实际上一句话就可以说清楚: 只有上层(包括上层的某种代理机制)系统询问我是否有某个事件发生了，否则我不会主动告诉上层系统事件发生了









