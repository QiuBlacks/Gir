[TOC]

# 栈

## 一、基本介绍

### 1、分类

分为java虚拟机栈和本地方法栈，这里主要讲虚拟栈

### 2、特点
存放基本数据类型、对象的引用、方法出口等，线程私有。
### 3、虚拟机栈结构
每个线程（方法）执行都会创建一个栈帧(Stack Frame)：用于存放局部变量表，操作栈，动态链接，方法出口
#### 3.1 、局部变量表(Local Variables)

​	一个数组

​	用于**存放方法参数和方法内部定义的局部变量**。

#### 3.2 操作数栈：

方法的执行操作在操作数栈中完成，每一个字节码指令往操作数栈进行写入和提取的过程，就是入栈和出栈的过程

#### 3.3 动态链接

方法区中存放着 线程中所有方法运行时对应的内存地址（每个栈帧都包含一个指向**运行时常量池（JVM 运行时数据区域）**中该栈帧所属方法的**引用**，持有这个引用是为了支持方法调用过程中的动态连接）

　在类加载阶段中的解析阶段会将符号引用转为直接引用，这种转化也称为静态解析。

　另外的一部分将在每一次运行时期转化为直接引用。这部分称为动态连接





#### 3.4 方法出口：

​			当一个方法执行完毕之后，要返回之前调用它的地方，因此在栈帧中必须保存一个方法返回地址

![image-20200612094815979](https://gitee.com/BlacksJack/picture-bed/raw/master/img/20200910165409.png)



### 4、Java虚拟机栈这个区域，Java虚拟机规范规定了两种异常：

- 如果线程请求分配的栈容量超过了 Java 虚拟机栈允许的最大容量，Java 虚拟机将会抛出 **StackOverflowError** 异常。

- 如果 Java 虚拟机栈可以动态扩展，并且在尝试扩展的时候无法申请到足够的内存，或者在创建新的线程时没有足够的内存去创建对应的虚拟机栈，那 Java 虚拟机将抛出一个 **OutOfMemoryError** 异常。

  

## 二、重要知识点

### 1、虚拟机栈和本地方法栈为什么是私有的?

- **虚拟机栈：** 每个 Java 方法在执行的同时会创建一个栈帧用于存储局部变量表、操作数栈、常量池引用等信息。从方法调用直至执行完成的过程，就对应着一个栈帧在 Java 虚拟机栈中入栈和出栈的过程。
- **本地方法栈：** 和虚拟机栈所发挥的作用非常相似，区别是： **虚拟机栈为虚拟机执行 Java 方法 （也就是字节码）服务，而本地方法栈则为虚拟机使用到的 Native 方法服务。** 在 HotSpot 虚拟机中和 Java 虚拟机栈合二为一。

所以，为了**保证线程中的局部变量不被别的线程访问到**，虚拟机栈和本地方法栈是线程私有的。







## 参考文章：

[JVM 系列 - 内存区域 - Java 虚拟机栈（三)](https://www.jianshu.com/p/ecfcc9fb1de7)

[Java虚拟机栈](https://www.cnblogs.com/old-cha/p/13089555.html)







