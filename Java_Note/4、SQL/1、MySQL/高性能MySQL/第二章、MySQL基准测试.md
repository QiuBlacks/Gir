# 第二章、MySQL基准测试

## 1、为什么需要基准测试

1.基准测试可以观察系统在不同压力下的行为，评估系统的容量，掌握哪些是重要的变化，或者观察系统如何处理不同的数据

## 2、基准测试的策略

### 2.1 两种主要的策略：

* 针对整个系统的整体测试（集成式full-stack）
* 单独测试MySQL（单组件式single-component）

### 2.2 测试何种指标：

- 吞吐量，指单位时间内的事务处理数，常用的测试单位是每秒事务数（TPS），或每分钟事务数（TPM）
- 响应时间或者延迟，用于测试任务所需的整体时间，根据具体的应用，测试的时间单位可能是微秒、毫秒、秒或者分钟。通常使用百分比响应时间（percentile response time）来替代最大响应时间
- 并发性，需要关注的是正在工作中的并发操作，或者是同时工作中的线程数或者连接数，在测试期间记录MySQL数据库的Threads_running状态值
- 可扩展性，给系统增加一倍的工作，在理想情况下就能获得两倍的效果（即吞吐量增加一倍），对于容量规范非常有用，可以提供其他测试无法提供的信息，来帮助发现应用的瓶颈



## 3、基准测试方法

1.需要避免的一些常见错误：

> * 使用真实数据的子集而不是全集
> * 使用错误的数据分布
> * 使用不真实的分布参数
> * 在多用户场景中，只做单用户测试
> * 在单服务器上测试分布式应用
> * 与真实用户行为不匹配
> * 反复执行同一个查询
> * 没有检查错误
> * 忽略了系统预热（warm up）的过程
> * 使用默认的服务器配置
> * 测试时间太短

2.应该建立将参数和结果文档化的规范，每一轮测试都必须进行详细记录
3.基准测试应该运行足够长的时间，需要在稳定状态下测试并观察
4.在执行基准测试时，需要尽可能多地收集被测试系统的信息
5.自动化基准测试可以防止测试人员偶尔遗漏某些步骤，或者误操作，另外也有助于归档整个测试过程，可以选择shell、php、perl等，要尽可能使所有测试过程都自动化，包括装载数据、系统预热、执行测试、记录结果等



## 3、基准测试工具

### 4.1 集成式测试工具：

* ab，测试HTTP服务器每秒最多可以处理多少请求
* http_load，和ab类似，但更加灵活
* jMeter，可以加载其他应用并测试其性能

### 4.2 单组件式测试工具

* mysqlslap，可以模拟服务器的负载，并输出计时信息
* MySQL Benchmark Suite(sql-bench)，单线程的，主要用于测试服务器执行查询的速度
* Super Smack，提供压力测试和负载生成，是一个复杂而强大的工具，可以模拟多用户访问，可以加载测试数据到数据库，并支持使用随机数据填充测试表
* Database Test Suite，类似某些工业标准测试的测试工具集
* Percona's TPCC-MySQWL Tool

* **sysbench**，多线程系统压测工具，可以根据影响数据库服务器性能的各种因素来评估系统的性能







