# 进程间通信

进程间通信又称IPC(Inter-Process Communication),指多个进程之间相互通信，交换信息的方法。根据进程通信时信息量大小的不同,可以将进程通信划分为两大类型:

## 1、低级通信

​		控制信息的通信(主要用于进程之间的同步,互斥,终止和挂起等等控制信息的传递)

## 2、高级通信

​	大批数据信息的通信(主要用于进程间数据块数据的交换和共享,常见的高级通信有管道,消息队列,共享内存等).

### 2.1 管道( pipe )

#### 2.1.1 匿名管道

管道是一种半双工的通信方式，数据只能**单向流动**，而且只能在**具有亲缘关系的进程间**使用。进程的亲缘关系通常是指父子进程关系。

```
netstat -tulnp | grep 8080
```

”|“是**管道**的意思，它的作用就是把前一条命令的输出作为后一条命令的输入。

这种通信方式是单向的，只能把第一个命令的输出作为第二个命令的输入，如果进程之间想要互相通信的话，那么需要创建两个管道。

#### 2.1.2 命名管道

有名管道也是半双工的通信方式，但是它**允许无亲缘关系**进程间的通信。

创建一个命名管道

```
mkfifo  test
```

接下来我们用一个进程向这个管道里面写数据，然后有另外一个进程把里面的数据读出来。

```bash
echo "this is a pipe" > test   #写数据
```

这个时候管道的内容没有被读出的话，那么这个命令就会一直停在这里，只有当另外一个进程把 test 里面的内容读出来的时候这条命令才会结束。接下来我们用另外一个进程来读取

```
cat < test  // 读数据
```

从上面的例子可以看出，管道的通知机制类似于**缓存**，就像一个进程把数据放在某个缓存区域，然后等着另外一个进程去拿，并且是管道是**单向传输的。**

这种通信方式有什么缺点呢？显然，这种通信方式**效率低下**，你看，**a 进程给 b 进程传输数据，只能等待 b 进程取了数据之后 a 进程才能返回。**

所以管道不适合频繁通信的进程。当然，他也有它的优点，例如比较简单，能够保证我们的数据已经真的被其他进程拿走了。我们平时用 Linux 的时候，也算是经常用。



### 2.2 消息队列( message queue ) 

#### 2.2.1  问题引出

那我们能不能把进程的数据放在某个内存之后就**马上让进程返回**呢？无需等待其他进程来取就返回呢？

#### 2.2.2  解决方法

消息队列是由消息的链表，存放在内核中并由**消息队列**标识符标识。消息队列克服了信号传递信息少、管道只能承载无格式字节流以及缓冲区大小受限等缺点。

例如 a 进程要给 b 进程发送消息，只需要把消息放在对应的消息队列里就行了，b 进程需要的时候再去对应的消息队列里取出来。同理，b 进程要给a 进程发送消息也是一样。这种通信方式也类似于**缓存**吧。

#### 2.2.3  缺点

如果 a 进程发送的数据占的内存比较大，并且两个进程之间的通信特别频繁的话，消息队列模型就不大适合了。因为 a 发送的数据很大的话，意味**发送消息（拷贝）**这个过程需要花很多时间来读内存。



### 2.3 共享内存( shared memory )

#### 2.3.1 问题引出

**共享内存**这个通信方式就可以很好着解决**拷贝**所消耗的时间了。

这个可能有人会问了，每个进程不是有自己的独立内存吗？两个进程怎么就可以共享一块内存了？

我们都知道，系统加载一个进程的时候，分配给进程的内存并不是**实际物理内存**，而是**虚拟内存空间**。那么我们可以让两个进程各自拿出一块虚拟地址空间来，然后映射到相同的物理内存中，这样，两个进程虽然有着独立的虚拟内存空间，但有一部分却是映射到相同的物理内存，这就完成了**内存共享**机制了。

#### 2.3.2  定义

共享内存就是映射一段能被其他进程所访问的内存，这段共享内存由一个进程创建，但多个进程都可以访问。共享内存是最快的 IPC 方式，它是针对其他进程间通信方式运行效率低而专门设计的。它往往与其他通信机制，如信号两，配合使用，来实现进程间的同步和通信。



### 2.4 信号量( semophore ) 

#### 2.4.1 问题引出

共享内存最大的问题是什么？没错，就是多进程竞争内存的问题，就像类似于我们平时说的**线程安全**问题。如何解决这个问题？这个时候我们的**信号量**就上场了。

信号量的本质就是一个**计数器**，用来实现进程之间的互斥与同步。

例如信号量的初始值是 1，然后 a 进程来访问**内存1**的时候，我们就把信号量的值设为 0，然后进程b 也要来访问**内存1**的时候，看到信号量的值为 0 就知道已经有进程在访问**内存1**了，这个时候进程 b 就会访问不了**内存1**。所以说，信号量也是进程之间的一种通信方式。

#### 2.4.2  概念

信号量是一个计数器，可以用来控制多个进程对共享资源的访问。不是用于交换大批数据,而用于多线程之间的同步.常作为一种锁机制,防止某进程在访问资源时其它进程也访问该资源。因此，主要作为进程间以及同一进程内不同线程之间的同步手段。



### 2.5  套接字( socket )

套解口也是一种进程间通信机制，与其他通信机制不同的是，它可用于不同机器间的进程通信。

此方法主要用于在客户端和服务器之间通过网络进行通信。套接字是支持TCP/IP的网络通信的基本操作单元，可以看做是不同主机之间的进程进行双向通信的端点，简单的说就是通信的两方的一种约定，用套接字中的相关函数来完成通信过程。





## 参考文献：

[JAVA线程与线程、进程与进程间通信](https://blog.csdn.net/ls5718/article/details/51878770)