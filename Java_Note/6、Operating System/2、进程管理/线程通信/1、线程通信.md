

# 一、线程间通信

## 1、为什么要线程通信？

线程是操作系统中独立的个体，但这些个体如果不经过特殊的处理就不能成为一个整体。多个线程并发执行时,在默认情况下CPU是随机切换线程的，当我们需要多个线程来共同完成一件任务，并且我们希望他们有规律的执行,那么多线程之间需要一些协调通信，以此来帮我们达到多线程共同操作一份数据。
  狭义上来说：线程通信的目标是使线程间能够互相发送信号(通知),另一方面，线程通信使线程能够等待其他线程的信号(通知),也称为线程间的等待/通知机制，或者生产消费模式！

广义上说：能够协调线程调度运行的方法都属于线程通信的应用，不应是一个线程主动通知另外一个线程，这个通知还可能是一个公共信号。



## 2、线程通信方式

### 2.1   锁机制：包括互斥锁、条件变量、读写锁

互斥锁提供了以排他方式防止数据结构被并发修改的方法。 
		读写锁允许多个线程同时读共享数据，而对写操作是互斥的。 
		条件变量可以以原子的方式阻塞进程，直到某个特定条件为真为止。对条件的测试是在互斥锁的保护下进行的。条件变量始终与互斥锁一起使用。



wait/notify 等待

使用 ReentrantLock 结合 Condition

共享变量

管道

Volatile 内存共享

while轮询的方式



### 2.2    信号量机制(Semaphore)

包括无名线程信号量和命名线程信号量。



### 2.3    信号机制(Signal)

类似进程间的信号处理。

线程间的通信目的主要是用于线程同步，所以线程没有像进程通信中的用于数据交换的通信机制。



## 3、线程间同步方式

各个线程可以访问进程中的公共变量，资源，所以使用多线程的过程中需要注意的问题是如何防止两个或两个以上的线程同时访问同一个数据，以免破坏数据的完整性。数据之间的相互制约包括

- 直接制约关系，即一个线程的处理结果，为另一个线程的输入，因此线程之间直接制约着，这种关系可以称之为同步关系

- 间接制约关系，即两个线程需要访问同一资源，该资源在同一时刻只能被一个线程访问，这种关系称之为线程间对资源的互斥访问，某种意义上说互斥是一种制约关系更小的同步

  

线程间的同步方式有四种

### 3.1  互斥量(Mutex)

采用互斥对象机制，只有拥有互斥对象的线程才有访问公共资源的权限。因为互斥对象只有一个，所以可以保证公共资源不会被多个线程同时访问。比如 Java 中的 synchronized 关键词和各种 Lock 都是这种机制。

### 3.2、信号量(Semphares) 

它允许同一时刻多个线程访问同一资源，但是需要控制同一时刻访问此资源的最大线程数量

### 3.3 、事件(Event) 

Wait/Notify：通过通知操作的方式来保持多线程同步，还可以方便的实现多线程优先级的比较操

### 3.4、临界区

临界区对应着一个CcriticalSection对象，当线程需要访问保护数据时，调用EnterCriticalSection函数；当对保护数据的操作完成之后，调用LeaveCriticalSection函数释放对临界区对象的拥有权，以使另一个线程可以夺取临界区对象并访问受保护的数据。







## 参考文献：

[java多线程之线程间的通信方式](https://www.cnblogs.com/hapjin/p/5492619.html)

[JAVA线程与线程、进程与进程间通信](https://blog.csdn.net/ls5718/article/details/51878770)





