# HTTP（HyperText Transfer Protocol）

# 一、基础知识

## 1、基本介绍

HTTP是什么呢？它是超文本传输协议，HTTP是缩写，它的全英文名是HyperText Transfer Protocol。

超文本传输协议，是一个基于请求与响应，**无状态**的，**应用层**的协议，常基于**TCP/IP协议**传输数据，互联网上应用最为广泛的一种网络协议,所有的WWW文件都必须遵守这个标准。设计HTTP的初衷是为了提供一种发布和接收HTML页面的方法。

### 2、版本

| 版本     | 内容                                                         |
| -------- | ------------------------------------------------------------ |
| HTTP/0.9 | 不涉及数据包传输，规定客户端和服务器之间通信格式，只能GET请求 |
| HTTP/1.0 | 传输内容格式不限制，增加PUT、PATCH、HEAD、 OPTIONS、DELETE命令 |
| HTTP/1.1 | 持久连接(长连接)、节约带宽、HOST域、管道机制、分块传输编码   |
| HTTP/2   | 多路复用、服务器推送、头信息压缩、二进制协议等               |



### 3、HTTP1.0 和 HTTP 1.1主要区别

#### 3.1 缓存处理

在HTTP1.0中主要使用header里的If-Modified-Since，Expires来做为缓存判断的标准，HTTP1.1则引入了更多的缓存控制策略例如Entity tag，If-Unmodified-Since, If-Match, If-None-Match等更多可供选择的缓存头来控制缓存策略。

#### 3.2 带宽优化及网络连接的使用

HTTP1.0中，存在一些浪费带宽的现象，例如客户端只是需要某个对象的一部分，而服务器却将整个对象送过来了，并且不支持断点续传功能

HTTP1.1则在请求头引入了range头域，它允许只请求资源的某个部分，即返回码是206（Partial Content），这样就方便了开发者自由的选择以便于充分利用带宽和连接。

#### 3.3 错误通知的管理

在HTTP1.1中新增了24个错误状态响应码，如409（Conflict）表示请求的资源与资源的当前状态发生冲突；410（Gone）表示服务器上的某个资源被永久性的删除。

#### 3.4 Host头处理

在HTTP1.0中认为每台服务器都绑定一个唯一的IP地址，因此，请求消息中的URL并没有传递主机名（hostname）。但随着虚拟主机技术的发展，在一台物理服务器上可以存在多个虚拟主机（Multi-homed Web Servers），并且它们共享一个IP地址。	

HTTP1.1的请求消息和响应消息都应支持Host头域，且请求消息中如果没有Host头域会报告一个错误（400 Bad Request）

#### 3.5 长连接

HTTP 1.0需要使用keep-alive参数来告知服务器端要建立一个长连接，而HTTP1.1默认支持长连接。



### 4、 HTTP 2.0：增加1.1的效率

#### 4.1 多路复用

HTTP2.0使用了多路复用的技术，做到同一个TCP连接并发处理多个请求，而且并发请求的数量比HTTP1.1大了好几个数量级。

当然HTTP1.1也可以多建立几个TCP连接，来支持处理更多并发的请求，但是创建TCP连接本身也是有开销的。

HTTP2的请求的TCP的connection一旦建立，后续请求以stream的方式发送。每个stream的基本组成单位是**frame**（二进制帧）。客户端和服务器可以把 **HTTP 消息分解为互不依赖的帧**，然后乱序发送，最后再在另一端把它们**重新组合**起来。



#### 4.2 数据header压缩

HTTP/1.1的header带有大量信息，而且每次都要重复发送。**HTTP/2 为了减少这部分开销，采用了HPACK 头部压缩算法对Header进行压缩。**

#### 4.3 服务器推送

当我们对支持HTTP2.0的web server请求数据的时候，服务器会**主动把一些客户端需要的资源一起推送到客户端**，免得客户端再次创建连接发送请求到服务器端获取。这种方式非常合适加载静态资源。

服务器端推送的这些资源其实存在客户端的某处地方，客户端直接从本地加载这些资源就可以了，不用走网络，速度自然是快很多的。

#### 4.4  二进制分帧

HTTP2.0采用二进制帧格式而非文本格式

HTTP/2中，在应用层（HTTP2.0）和传输层（TCP或者UDP）之间加了一层：二进制分帧层。

**在二进制分帧层中， HTTP/2 会将所有传输的信息分割为更小的消息和帧（frame）,并对它们采用二进制格式的编码。**

这种单连接多资源的方式，减少了服务端的压力，使得内存占用更少，连接吞吐量更大。而且，TCP连接数的减少使得网络拥塞状况得以改善，同时慢启动时间的减少，使拥塞和丢包恢复速度更快。



帧：HTTP2.0通信的最小单位，每个帧包含帧头部，至少也会标识出当前帧所属的流

帧对数据进行顺序标识，如下图所示，这样浏览器收到数据之后，就可以按照序列对数据进行合并，而不会出现合并后数据错乱的情况。同样是因为有了序列，服务器就可以并行的传输数据，这就是流所做的事情。



# 二、Http3.0：QUIC

## 1、问题引出

### 1.1  http队头阻塞问题

早在HTTP/1.1时代，就一直存在着队头阻塞的问题。

HTTP/1.1允许在持久连接上使用**请求管道**，所谓请求管道，就是在HTTP响应到达之前，可以将多条请求放入队列，当第一条HTTP请求通过网络流向服务器时，第二条和第三条请求也可以开始发送了。在高时延网络条件下，这样做可以降低网络的环回时间，提高性能。

**但是，对于管道连接还是有一定的限制和要求的，其中一个比较关键的就是服务端必须按照与请求相同的顺序回送HTTP响应。**

这也就意味着，如果一个响应返回发生了延迟，那么其后续的响应都会被延迟，直到队头的响应送达。这就是所谓的**HTTP队头阻塞**。



### 2.0 TCP队头阻塞问题

**HTTP/2解决了HTTP的队头阻塞问题，但是并没有解决TCP队头阻塞问题！**

HTTP/2废弃了管道化的方式，而是创新性的引入了帧、消息和数据流等概念。**客户端和服务器可以把 HTTP 消息分解为互不依赖的帧，然后乱序发送，最后再在另一端把它们重新组合起来。**

**因为没有顺序了，所以就不需要阻塞了，就有效的解决了HTTP队头阻塞的问题。**

但是，**HTTP/2仍然会存在TCP队头阻塞**的问题，那是因为HTTP/2其实还是依赖TCP协议实现的。

TCP传输过程中会把数据拆分为一个个**按照顺序**排列的数据包，这些数据包通过网络传输到了接收端，接收端再**按照顺序**将这些数据包组合成原始数据，这样就完成了数据传输。

但是如果其中的某一个数据包没有按照顺序到达，接收端会一直保持连接等待数据包返回，这时候就会阻塞后续请求。这就发生了**TCP队头阻塞**。

HTTP/1.1的管道化持久连接也是使得同一个TCP链接可以被多个HTTP使用，但是HTTP/1.1中规定一个域名可以有6个TCP连接。而HTTP/2中，同一个域名只是用一个TCP连接。

所以，**在HTTP/2中，TCP队头阻塞造成的影响会更大**，因为HTTP/2的多路复用技术使得多个请求其实是基于同一个TCP连接的，那如果某一个请求造成了TCP队头阻塞，那么多个请求都会受到影响。



## 2、解决思路

### 2.1 升级TCP是否可行？

如果TCP协议需要升级，那么意味着需要这些中间设备都能支持新的特性，我们知道路由器我们可以重新换一个，但是其他的那些中间设备呢？尤其是那些比较大型的设备呢？更换起来的成本是巨大的。



## 3、QUIC 

QUIC (Quick UDP Internet Connections), 快速 UDP 互联网连接。QUIC是基于UDP协议的。





## 参考文章

[HTTP/2做错了什么？刚刚辉煌2年就要被弃用了！？](https://mp.weixin.qq.com/s?__biz=MzI3NzE0NjcwMg==&mid=2650149026&idx=1&sn=86d460045bce89d72289de8ad389aa46&chksm=f3680d83c41f8495992aae7b4a45de5e7783e2af26ae59d89e29262dd55e2e10f9fda5274ffa&scene=126&sessionid=1607913067&key=dcd3ddfb631e4813e3a6b596f41a167e575ba4a6e7c49b338dc83beb8313f5fcb298f31f2278517de0eddb8cab5043403bd03f962c2a7eb03441cee8205bf251920674c6c4fd8e38b6fa412a88bf682f1e042e6c4c6b8e32c36091d4a3eab93d047a42fd6015e178b3e1ba65df86659a2daea6409be6cdfff1405b8e2998c027&ascene=1&uin=MTg5MjE1NTkyOQ%3D%3D&devicetype=Windows+10+x64&version=6300002f&lang=zh_CN&exportkey=A18Y5qTWake6ZazQOh5BeMY%3D&pass_ticket=%2FJ1RGCmeP7x1jzsmZ3qRIXjVKNHgD3iXeBIkyv3%2F1ocF9PK%2F97Zv9zFZnLpSFrZP&wx_header=0)

