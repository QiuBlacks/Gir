# TCP和UDP

# 一、基本介绍

### 1、TCP（Transmission Control Protocol）：传输控制协议

提供面向连接的可靠的服务

### 2、UDP（User Datagram Protocol）：用户数据报协议

提供无连接的不可靠的服务

### 3、协议

基于TCP的协议有：HTTP、HTTPS、Telnet、FTP、SMTP

基于UDP的协议有：DHCP、DNS、SNMP、TFTP、BOOTP



# 二、TCP

### 1、面向连接：

指发送数据之前必须在两端建立连接。建立连接的方法是“三次握手”，这样能建立可靠的连接。建立连接，是为数据的可靠传输打下了基础。

延迟大，实时性不好；开销大

### 2、如何实现可靠传输：

1. 应用数据被分割成 TCP 认为最适合发送的数据块。
2. TCP 给发送的每一个包进行编号，接收方对数据包进行排序，把有序数据传送给应用层。
3. **校验和：** TCP 将保持它首部和数据的检验和。这是一个端到端的检验和，目的是检测数据在传输过程中的任何变化。如果收到段的检验和有差错，TCP 将丢弃这个报文段和不确认收到此报文段。
4. TCP 的接收端会丢弃重复的数据。
5. **流量控制：** TCP 连接的每一方都有固定大小的缓冲空间，TCP的接收端只允许发送端发送接收端缓冲区能接纳的数据。当接收方来不及处理发送方的数据，能提示发送方降低发送的速率，防止包丢失。TCP 使用的流量控制协议是可变大小的滑动窗口协议。 （TCP 利用滑动窗口实现流量控制）
6. **拥塞控制：** 当网络拥塞时，减少数据的发送。
7. **ARQ协议：** 也是为了实现可靠传输的，它的基本原理就是每发完一个分组就停止发送，等待对方确认。在收到确认后再发下一个分组。
8. **超时重传：** 当 TCP 发出一个段后，它启动一个定时器，等待目的端确认收到这个报文段。如果不能及时收到一个确认，将重发这个报文段。





### 3、使用场景

TCP 一般用于文件传输、发送和接收邮件、远程登录等场景。



# 三、UDP

### 1、无连接

不需要在传输之前建立连接；UDP的非连接性让它不需要给每一个数据报编号，和发送确认号。它的延迟就更少，实时性好。

### 2、不可靠

对于差错的控制是不可靠的：

①没有确认机制。每当接收端接收到数据段之后，进行差错校验，不论是否有误，都不会给发送端进行反馈，如果有错误就丢弃。这样发送端就不知道这个数据段的传输情况，这对于提升效率是有好处的。

②不对报文排序 即使数据段的顺序是不对的，接收端也不会返回错误或者进行排序 

③没有反馈机制进行流量控制 流量控制能够有效避免接收端处理太慢从而造成缓冲区溢出的丢包事件，但是UDP没有这方面的处理，丢了就是丢了，也不会给发送端报告错误。

④没有超时机制  丢包了也不会重发。

### 3、使用场景

适于像视频传输那种对于正确率要求并不是很高，但是要求延迟低的应用。

比如： QQ 语音、 QQ 视频 、直播等等



# 四、区别

![image-20200513110108679](C:\Users\彼岸の烟火\AppData\Roaming\Typora\typora-user-images\image-20200513110108679.png)



### 1、特点

- TCP 是面向连接的，UDP 是无连接的，即
  - TCP 在传输数据前要先通过三次握手建立连接，而且在数据传递时，有确认、窗口、重传、拥塞控制机制建立连接，数据传输结束后要释放连接。
  - UDP 在传输数据前不需要建立连接，远地主机在接收到报文之后也无需确认。
- 所以 TCP 是可靠传输，UDP 是不可靠传输。
- TCP 因为有连接，所以数据以字节流的形式传输，UDP 则以数据报文段形式传输，而且 TCP 只能是一对一的，而 UDP 可以各种通信。

### 2、性能

 TCP 传输效率慢，需要资源多，但可靠。

UDP 传输效率快，需要资源少，但不可靠。

### 3、应用场景

 TCP 应用在要求传输数据可靠的情况下，如文件传输、邮件传输等。

UDP 应用在要求通信速度但对可靠性要求比较低的场景，如 QQ 语音、视频等。

### 4、首部字节

 TCP 首部有 20 ~ 60 个字节，UDP 首部由 8 个字节 4 个字段组成。





