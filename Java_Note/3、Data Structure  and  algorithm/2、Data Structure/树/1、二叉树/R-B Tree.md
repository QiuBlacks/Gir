[TOC]



#  R-B Tree

# 一、基本介绍

## 1、定义

红黑树（Red-Black Tree）：一种特殊的二叉查找树，每个节点上都有存储位表示节点的颜色，可以是红(Red)或黑(Black)

为了**防止一棵二分搜索树退化成链表**，我们有了 AVL 树和红黑树。

## 2、特性:

（1）每个节点或者是黑色，或者是红色。

（2）根节点是黑色。

（3）每个叶子节点（NIL）是黑色。 [注意：这里叶子节点，是指**为空的叶子节点(即图中的NIL或NULL)！**]

（4）没有两个相邻的红色节点（红色节点不能有红色父节点或红色子节点，并没有说不能出现连续的黑色节点）

（5）从节点（包括根）到其任何后代NULL节点  (叶子结点下方挂的两个空节点，并且认为他们是黑色的)   的每条路径都具有相同数量的黑色节点

提示：特性（5）确保没有一条路径会比其他路径长出俩倍。因而，红黑树是相对是接近平衡的二叉树。

## 3、图解



![image-20200513173855917](https://gitee.com/BlacksJack/picture-bed/raw/master/img/20200910181946.png)



## 4、应用场景

主要是用它来存储有序的数据（**增删频繁**），它的时间复杂度是O(lgn)，效率非常之高

1. 广泛用于C ++的STL中，地图是用红黑树实现的;
2. Linux的的进程调度，用红黑树管理进程控制块，进程的虚拟内存空间都存储在一颗红黑树上，每个虚拟内存空间都对应红黑树的一个节点，左指针指向相邻的虚拟内存空间，右指针指向相邻的高地址虚拟内存空间;
3. IO多路复用的epoll采用红黑树组织管理sockfd，以支持快速的增删改查;
4. Nginx中用红黑树管理定时器，因为红黑树是有序的，可以很快的得到距离当前最小的定时器;
5. Java的TreeMap的实现;





# 二、基础操作

旋转的基础就是左左和右右

## 1、左旋：当前结点是在左子树

### 1.1 左左

普通的左旋转

<img src="https://gitee.com/BlacksJack/picture-bed/raw/master/img/20200910181947.png" alt="image-20200903154242678" style="zoom:67%;" />

### 1.2 左右

先进行一次左旋变成左左的情况

<img src="https://gitee.com/BlacksJack/picture-bed/raw/master/img/20200910181948.png" alt="image-20200903154255402" style="zoom:67%;" />

## 2、右旋：当前结点是在右子树

### 2.1 右右

<img src="https://gitee.com/BlacksJack/picture-bed/raw/master/img/20200910181949.png" alt="image-20200903154349248" style="zoom:67%;" />

### 2.2 右左

<img src="https://gitee.com/BlacksJack/picture-bed/raw/master/img/20200910181950.png" alt="image-20200903154357411" style="zoom:67%;" />

## 3、变色







# 三、高级操作

## 1、插入

情况考虑：

### 1.1  红黑树为空树

直接把插入结点设成黑色并作为根结点。

### 1.2  插入结点的 key 已存在

二叉搜索树中不能插入相同元素，既然结点的 key 已经存在，红黑树也已平衡，无需重复插入。

**处理**：

- 将插入结点设为将要替换结点的颜色
- 更新当前结点的值为插入结点的值

### 1.3 插入结点的父结点为黑色

插入的结点默认是红色的，当它的父结点是黑色时，并不会破坏平衡。

**处理**：直接插入。

### 1.4 插入结点的父结点为红色

#### 1.4.1 存在叔父结点，且为红色

![image-20200903163019137](https://gitee.com/BlacksJack/picture-bed/raw/master/img/20200910181951.png)

**处理**：

- 将父结点和叔父结点变为黑色
- 将祖父结点变为红色
- 将祖父结点设置为当前插入结点

#### 1.4.2 叔父结点不存在或为黑色

1）存在叔父结点，且为红色

就是左旋转和右旋转的四种情况

1）左左

![image-20200903163115063](https://gitee.com/BlacksJack/picture-bed/raw/master/img/20200910181952.png)

**处理**：

- 将父结点变为黑色
- 将祖父结点变为红色
- 将祖父结点右旋



不写那么多了





## 2、删除

**二叉搜索树删除**的时候可能出现三种场景：

- 场景一：若删除结点**无**子结点，**直接删除**即可；
- 场景二：若删除结点只有**一个**子结点，用**子结点**替换删除结点；
- 场景三：若删除结点有**两个**子结点，用**后继结点（删除节点的子树中，大于删除结点的最小结点）**替换删除结点。

注意就是找到**替换节点**，可以由场景三 ==》场景二 ==》场景一

**替换结点是即将被替换到删除结点的位置**

根据替换节点的情况考虑：

![img](https://gitee.com/BlacksJack/picture-bed/raw/master/img/20200910181953)







## 参考文章

[【程序员面试必备】红黑树详细图解](https://juejin.im/post/6844904069723586568#heading-14)

https://www.cnblogs.com/skywang12345/p/3245399.html

[红黑树，超强动静图详解，简单易懂](https://zhuanlan.zhihu.com/p/79980618)